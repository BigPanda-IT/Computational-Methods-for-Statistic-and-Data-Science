---
title: "P6_27"
output: html_document
date: "2024-11-27"
---

```{r}
library(Rcpp)
sourceCpp("mySweep_cpp.cpp")

set.seed(123)
X <- matrix(rnorm(500*500), nrow = 500, ncol = 500)
A <- t(X) %*% X
n <- nrow(A)
p <- ncol(A)


# Измерение времени выполнения R функции
start_time <- Sys.time()
result_R <- mySweep(A, p)
end_time <- Sys.time()
time_R <- end_time - start_time
print(paste("Время выполнения R функции:", time_R))


# Измерение времени выполнения C++ функции
start_time <- Sys.time()
result_cpp <- mySweep_cpp(A, p)
end_time <- Sys.time()
time_cpp <- end_time - start_time
print(paste("Время выполнения C++ функции:", time_cpp))


# Проверка на равенство результатов (необязательно, но желательно)
all.equal(result_R, result_cpp)

mySweep <- function(A, m) {
  n <- dim(A)[1]
  for (k in 1:m) {
    for (i in 1:n)
      for (j in 1:n)
        if (i != k & j != k)
          A[i, j] <- A[i, j] - A[i, k] * A[k, j] / A[k, k]
    for (i in 1:n)
      if (i != k)
        A[i, k] <- A[i, k] / A[k, k]
    for (j in 1:n)
      if (j != k)
        A[k, j] <- A[k, j] / A[k, k]
    A[k, k] <- -1 / A[k, k]
  }
  return(A)
}
```